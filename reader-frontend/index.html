<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Blog</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        ul { list-style: none; padding: 0; }
        li { border: 1px solid #ddd; padding: 10px; margin: 10px 0; }
        form { margin-top: 10px; }
    </style>
</head>
<body>
    <h1>My Blog</h1>

    <ul id="posts-list"></ul>

    <script>
        const apiBase = process.env.API_BASE_URL || 'http://localhost:5000/api';

        async function fetchPosts() {
            try {
                const res = await fetch(`${apiBase}/posts`);
                const posts = await res.json();
                const list = document.getElementById('posts-list');
                list.innerHTML = '';
                posts.forEach(post => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <h3>${post.title}</h3>
                        <p>${post.content}</p>
                        <h4>Comments</h4>
                        <ul>${post.comments.map(c => `<li>${c.content} - ${c.username || 'Anon'}</li>`).join('')}</ul>
                        <form onsubmit="addComment(event, ${post.id})">
                            <input type="text" placeholder="Comment" required>
                            <button type="submit">Add Comment</button>
                        </form>
                    `;
                    list.appendChild(li);
                });
            } catch (err) {
                alert('Error fetching posts');
            }
        }

        async function addComment(e, postId) {
            e.preventDefault();
            const content = e.target.querySelector('input').value;
            try {
                const res = await fetch(`${apiBase}/posts/${postId}/comments`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ content })
                });
                if (res.ok) {
                    fetchPosts();
                    alert('Comment added');
                } else {
                    alert('Error adding comment');
                }
            } catch (err) {
                alert('Error: ' + err.message);
            }
        }

        fetchPosts();
    </script>
</body>
</html>